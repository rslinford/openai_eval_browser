<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>Openai Eval Browser</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<form action="/home" method="post" id="main_form">
    <div class="flex">
        <label for="sub_dir">Data directory: </label>
        <select id="sub_dir" name="sub_dir" style="width: 200px;" onchange="document.getElementById('main_form').submit()">
            {% for sub_dir in sub_dirs %}
                <option>{{ sub_dir }}</option>
            {% endfor %}
        </select>
    </div>
    <script>
        // Preserve selected sub_dir
        (function () {
            const select = document.getElementById("sub_dir");
            const previous_sub_dir = "{{ sub_dir }}";
            for (let i = 0; i < select.options.length; i++) {
                const option = select.options[i];
                if (option.value === previous_sub_dir) {
                    select.selectedIndex = i;
                }
            }
        })();
    </script>
    <div class="flex">
        <label for="sample">Samples: </label>
        <select id="sample" name="sample" onchange="document.getElementById('main_form').submit()" autofocus>
            {% for sample in samples %}
                <option value="{{ loop.index0 }}">{{ sample }}</option>
            {% endfor %}
        </select>
    </div>
    <script>
        // Preserve selected sample
        (function () {
            const select = document.getElementById("sample");
            select.selectedIndex = "{{ sample_index }}";
        })();
    </script>
    {% for message in sample['input'] %}
        <div class="flex">
            <input type="text" style="width: 80px; margin-right: 10px;" value="{{ message['role'] }}" readonly/>
            <textarea rows="1" cols="100" readonly>{{ message['content'] }}</textarea>
        </div>
    {% endfor %}
    <div class="flex">
        <input type="text" style="width: 80px; margin-right: 10px;" value="Ideal" readonly/>
        <textarea rows="1" cols="100" readonly>{{ sample['ideal'] }}</textarea>
    </div>
    <div class="flex">
        <input type="submit" id="Prompt" name="Prompt" class="button_margin" value="Prompt">
    </div>
</form>
<label for="assistant_response">Assistant Response:</label>
<textarea id="assistant_response" rows="3" cols="100" readonly>{{ assistant_response }}</textarea>
<label for="finish_reason" class="nowrap">Result Message:</label>
<input type="text" id="finish_reason" value="{{ finish_reason }}" readonly/>
<script>
    // Expand textareas to fit their content
    (function () {
        const textareas = document.getElementsByTagName("textarea");
        Array.from(textareas).forEach(function (textarea) {
            textarea.style.height = textarea.scrollHeight + 'px';
        });
    })();
</script>
<script>
    // Change appearance of submit button while page is waiting on API call
    (function () {
        // Get the submit button element
        const submitButton = document.getElementById("Prompt");
        submitButton.addEventListener("click", function () {
            // Change the button appearance
            submitButton.classList.add("disabled");
        });
        // Change the button back to its original appearance when the page is loaded
        window.addEventListener("load", function () {
            submitButton.classList.remove("disabled");
        });
    })();
</script>
</body>
</html>
